---
title: "Evidencia FINAL"
author: 'Equipo #9'
date: "2022-10-04"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



# Librerías
```{r}

library(e1071)
library(plyr)

```



# Bases de Datos
```{r}

# Importar "PC19_Muestra_Estratificada_Diabetes.csv"
data = read.csv("PC19_Muestra_Estratificada_Diabetes.csv", encoding = "UTF-8")

```



# Tablas de Datos Útiles | Datos Muestrales
```{r}

# Matriz numerica 4x5 | Casos Confirmados SARS-COV-2 (CCM vs SCM) | Datos Muestrales
  TCP = matrix(rep(0, times=20), ncol=5, byrow=TRUE)
  colnames(TCP) = c("2022", "2021", "NL", "CDMX", "Total Muestral")
  rownames(TCP) = c("CCM Sobrevivientes", "CCM Total", "SCM Sobreviveintes", "SCM Total")

# Asignar valores a la matriz    
  # Subset: comorbilidad (diabetes) presente | root: data
     CCM = subset(data, data$DIABETES == "1")
    # Subset: sobrevivientes | root: CCM
      CCM_S = subset(CCM, CCM$FECHA_DEF == "9999-12-31")
    # Sobrevivientes 2022 | root CCM_S
      TCP[1,1] = nrow(subset(CCM_S, CCM_S$FECHA_INGRESO >= "2022-01-01"))
    # Total 2022 | root: CCM
      TCP[2,1] = nrow(subset(CCM, CCM$FECHA_INGRESO >= "2022-01-01"))
    # Sobrevivientes 2021 | root CCM_S
      TCP[1,2] = nrow(subset(CCM_S, CCM_S$FECHA_INGRESO < "2022-01-01" & CCM_S$FECHA_INGRESO >= "2021-01-01")) 
    # Total 2021 | root: CCM
      TCP[2,2] = nrow(subset(CCM, CCM$FECHA_INGRESO < "2022-01-01" & CCM$FECHA_INGRESO >= "2021-01-01"))
    # Sobreviventes NL | root CCM_S
      TCP[1,3] = nrow(subset(CCM_S, CCM_S$ENTIDAD_NAC=="19")) 
    # Total NL | root: CCM
      TCP[2,3] = nrow(subset(CCM, CCM$ENTIDAD_NAC=="19"))
    # Sobreviventes CDMX | root CCM_S
      TCP[1,4] = nrow(subset(CCM_S, CCM_S$ENTIDAD_NAC=="9")) 
    # Total CDMX | root: CCM
      TCP[2,4] = nrow(subset(CCM, CCM$ENTIDAD_NAC=="9"))
    # Sobrevivientes Total Muestral | root: CCM_S
      TCP[1,5] = nrow(CCM_S)
    # Total Muestral | root: CCM
      TCP[2,5] = nrow(CCM)

# Asignar valores a la matriz    
  # Subset: comorbilidad (diabetes) ausente | root: data
     SCM = subset(data, data$DIABETES == "2")
    # Subset: sobrevivientes | root: SCM
      SCM_S = subset(SCM, SCM$FECHA_DEF == "9999-12-31")
    # Sobrevivientes 2022 | root SCM_S
      TCP[3,1] = nrow(subset(SCM_S, SCM_S$FECHA_INGRESO >= "2022-01-01"))
    # Total 2022 | root: SCM
      TCP[4,1] = nrow(subset(SCM, SCM$FECHA_INGRESO >= "2022-01-01"))
    # Sobrevivientes 2021 | root SCM_S
      TCP[3,2] = nrow(subset(SCM_S, SCM_S$FECHA_INGRESO < "2022-01-01" & SCM_S$FECHA_INGRESO >= "2021-01-01")) 
    # Total 2021 | root: SCM
      TCP[4,2] = nrow(subset(SCM, SCM$FECHA_INGRESO < "2022-01-01" & SCM$FECHA_INGRESO >= "2021-01-01"))
    # Sobreviventes NL | root SCM_S
      TCP[3,3] = nrow(subset(SCM_S, SCM_S$ENTIDAD_NAC=="19")) 
    # Total NL | root: SCM
      TCP[4,3] = nrow(subset(SCM, SCM$ENTIDAD_NAC=="19"))
    # Sobreviventes CDMX | root SCM_S
      TCP[3,4] = nrow(subset(SCM_S, SCM_S$ENTIDAD_NAC=="9")) 
    # Total CDMX | root: SCM
      TCP[4,4] = nrow(subset(SCM, SCM$ENTIDAD_NAC=="9"))
    # Sobrevivientes Total Muestral | root: SCM_S
      TCP[3,5] = nrow(SCM_S)
    # Total Muestral | root: SCM
      TCP[4,5] = nrow(SCM)

# Generar tabla | root: TCP
  TCP = as.table(TCP)
  cat("Casos Confirmados SARS-COV-2 (CCM vs SCM) | Datos Muestrales\n\n")
  cat("     CCM: Con comorbilidad, SCM: Sin comorbilidad\n\n")
  TCP


# Matriz numerica 2x3 | Casos Confirmados SARS-COV-2 (Neumonía e Intubados) | Datos Muestrales
  TCP_NI = matrix(rep(0, times=6), ncol=3, byrow=TRUE)
  colnames(TCP_NI) = c("Neumonía", "Intubados", "Total Muestral")
  rownames(TCP_NI) = c("CCM", "SCM")  
  
# Asignar valores a la matriz    
  # Neumonía CCM | root CCM
    TCP_NI[1,1] = nrow(subset(CCM, CCM$NEUMONIA == "1"))
  # Intubados CCM | root CCM
    TCP_NI[1,2] = nrow(subset(CCM, CCM$INTUBADO == "1"))
  # Total Muestral CCM | root CCM
    TCP_NI[1,3] = nrow(CCM)
  # Neumonía SCM | root SCM
    TCP_NI[2,1] = nrow(subset(SCM, SCM$NEUMONIA == "1"))
  # Intubados SCM | root SCM
    TCP_NI[2,2] = nrow(subset(SCM, SCM$INTUBADO == "1"))
  # Total Muestral SCM | root SCM
    TCP_NI[2,3] = nrow(SCM)

# Generar tabla | root: TCP
  TCP_NI = as.table(TCP_NI)
  cat("\n\nCasos Confirmados SARS-COV-2 (Neumonía e Intubados) | Datos Muestrales\n\n")
  cat("     CCM: Con comorbilidad, SCM: Sin comorbilidad\n\n")
  TCP_NI
  
  
# Matriz numerica 2x4 | Casos Confirmados SARS-COV-2 (General) | Datos Muestrales
  TCP_SG = matrix(rep(0, times=8), ncol=4, byrow=TRUE)
  colnames(TCP_SG) = c("2022", "2021", "NL", "CDMX")
  rownames(TCP_SG) = c("Sobrevivientes", "Total")  
  
# Asignar valores a la matriz    
  # Sobrevivientes 2022 | root data
    TCP_SG[1,1] = nrow(subset(data, data$FECHA_DEF=="9999-12-31" & data$FECHA_INGRESO >= "2022-01-01"))
  # Total 2022 | root data
    TCP_SG[2,1] = nrow(subset(data, data$FECHA_INGRESO >= "2022-01-01"))
  # Sobrevivientes 2021 | root data
    TCP_SG[1,2] = nrow(subset(data, data$FECHA_DEF=="9999-12-31" & data$FECHA_INGRESO < "2022-01-01" & data$FECHA_INGRESO >= "2021-01-01"))
  # Total 2021 | root data
    TCP_SG[2,2] = nrow(subset(data, data$FECHA_INGRESO < "2022-01-01" & data$FECHA_INGRESO >= "2021-01-01"))
  # Sobrevivientes NL | root data
    TCP_SG[1,3] = nrow(subset(data, data$FECHA_DEF=="9999-12-31" & data$ENTIDAD_NAC=="19"))
  # Total NL | root data
    TCP_SG[2,3] = nrow(subset(data, data$ENTIDAD_NAC=="19"))
  # Sobrevivientes CDMX | root data
    TCP_SG[1,4] = nrow(subset(data, data$FECHA_DEF=="9999-12-31" & data$ENTIDAD_NAC=="9"))
  # Total CDMX | root data
    TCP_SG[2,4] = nrow(subset(data, data$ENTIDAD_NAC=="9"))
    
# Generar tabla | root: TCP
  TCP_SG = as.table(TCP_SG)
  cat("\n\nCasos Confirmados SARS-COV-2 (General) | Datos Muestrales\n\n")
  TCP_SG
  

  
# Matriz numerica 2x4 | Casos Confirmados SARS-COV-2 (Por año) | Datos Muestrales
  TCP_SG_PA = matrix(rep(0, times=6), ncol=3, byrow=TRUE)
  colnames(TCP_SG_PA) = c("2022", "2021", "2020")
  rownames(TCP_SG_PA) = c("Sobrevivientes", "Difuntos")  
  
# Asignar valores a la matriz    
  # Sobrevivientes 2022 | root data
    TCP_SG_PA[1,1] = nrow(subset(data, data$FECHA_DEF=="9999-12-31" & data$FECHA_INGRESO >= "2022-01-01"))
  # Difuntos 2022 | root data
    TCP_SG_PA[2,1] = nrow(subset(data, data$FECHA_DEF!="9999-12-31" & data$FECHA_INGRESO >= "2022-01-01"))
  # Sobrevivientes 2021 | root data
    TCP_SG_PA[1,2] = nrow(subset(data, data$FECHA_DEF=="9999-12-31" & data$FECHA_INGRESO < "2022-01-01" & data$FECHA_INGRESO >= "2021-01-01"))
  # Difuntos 2021 | root data
    TCP_SG_PA[2,2] = nrow(subset(data, data$FECHA_DEF!="9999-12-31" & data$FECHA_INGRESO < "2022-01-01" & data$FECHA_INGRESO >= "2021-01-01"))
  # Sobrevivientes 2020 | root data
    TCP_SG_PA[1,3] = nrow(subset(data, data$FECHA_DEF=="9999-12-31" & data$FECHA_INGRESO < "2021-01-01" & data$FECHA_INGRESO >= "2020-01-01"))
  # Difuntos 2020 | root data
    TCP_SG_PA[2,3] = nrow(subset(data, data$FECHA_DEF!="9999-12-31" & data$FECHA_INGRESO < "2021-01-01" & data$FECHA_INGRESO >= "2020-01-01"))
    
# Generar tabla | root: TCP
  TCP_SG_PA = as.table(TCP_SG_PA)
  cat("\n\nCasos Confirmados SARS-COV-2 (Por año) | Datos Muestrales\n\n")
  TCP_SG_PA
  
```



# Manejo de datos | Proporciones | Datos Muestrales
```{r}

# Proporcion: sobrevientes totales con comorbilidad | root: TCP
  P_CCM_S = TCP[1,5] / TCP[2,5]
# Proporcion: sobrevientes totales sin comorbilidad | root: TCP
  P_SCM_S = TCP[3,5] / TCP[4,5]
# Proporcion: sobrevientes 2022 con comorbilidad | root: TCP
  P_CCM_S2022 = TCP[1,1] / TCP[2,1]
# Proporcion: sobrevientes 2022 sin comorbilidad | root: TCP
  P_SCM_S2022 = TCP[3,1] / TCP[4,1]
# Proporcion: sobrevientes 2021 con comorbilidad | root: TCP
  P_CCM_S2021 = TCP[1,2] / TCP[2,2]
# Proporcion: sobrevientes 2021 sin comorbilidad | root: TCP
  P_SCM_S2021 = TCP[3,2] / TCP[4,2]
# Proporcion: sobrevientes NL con comorbilidad | root: TCP
  P_CCM_SNL = TCP[1,3] / TCP[2,3]
# Proporcion: sobrevientes NL sin comorbilidad | root: TCP
  P_SCM_SNL = TCP[3,3] / TCP[4,3]
# Proporcion: sobrevientes CDMX con comorbilidad | root: TCP
  P_CCM_SCDMX = TCP[1,4] / TCP[2,4]
# Proporcion: sobrevientes CDMX sin comorbilidad | root: TCP
  P_SCM_SCDMX = TCP[3,4] / TCP[4,4]

# Proporción: neumonía con comorbilidad | root: TCP_NI
  P_CCM_N = TCP_NI[1,1] / TCP_NI[1,3]
# Proporción: neumonía sin comorbilidad | root: TCP_NI
  P_SCM_N = TCP_NI[2,1] / TCP_NI[2,3]
# Proporción: intubados con comorbilidad | root: TCP_NI
  P_CCM_I = TCP_NI[1,2] / TCP_NI[1,3]
# Proporción: intubados sin comorbilidad | root: TCP_NI
  P_SCM_I = TCP_NI[2,2] / TCP_NI[2,3]
  
# Propporción: sobrevivientes 2022 | root: TCP_SG
  P_S2022 = TCP_SG[1,1] / TCP_SG[2,1]
# Propporción: sobrevivientes 2021 | root: TCP_SG
  P_S2021 = TCP_SG[1,2] / TCP_SG[2,2]
# Propporción: sobrevivientes NL | root: TCP_SG
  P_SNL = TCP_SG[1,3] / TCP_SG[2,3]
# Propporción: sobrevivientes CDMX | root: TCP_SG
  P_SCDMX = TCP_SG[1,4] / TCP_SG[2,4]

```



# Tablas de Proporciones | Datos Muestrales
```{r}

# Matriz numerica 2x5 | Tasa de superviviencia SARS-COV-2 | Datos Muestrales
  PTCP = matrix(rep(0, times=10), ncol=5, byrow=TRUE)
  colnames(PTCP) = c("2022", "2021", "NL", "CDMX", "Total Muestral")
  rownames(PTCP) = c("CCM", "SCM")

# Asignar valores a la matriz
  PTCP[1,1] = round(P_CCM_S2022,4)
  PTCP[1,2] = round(P_CCM_S2021,4)
  PTCP[1,3] = round(P_CCM_SNL,4)
  PTCP[1,4] = round(P_CCM_SCDMX,4)
  PTCP[1,5] = round(P_CCM_S,4)
  PTCP[2,1] = round(P_SCM_S2022,4)
  PTCP[2,2] = round(P_SCM_S2021,4)
  PTCP[2,3] = round(P_SCM_SNL,4)
  PTCP[2,4] = round(P_SCM_SCDMX,4)
  PTCP[2,5] = round(P_SCM_S,4)
  
# Generar tabla | root: TCP
  PTCP = as.table(PTCP)
  cat("Tasa de superviviencia SARS-COV-2 | Datos Muestrales\n\n")
  cat("     CCM: Con comorbilidad, SCM: Sin comorbilidad\n\n")
  PTCP
  
# Matriz numerica 2x2 | Tasa de Neumonía e Intubados | Datos Muestrales
  PTCP_NI = matrix(rep(0, times=4), ncol=2, byrow=TRUE)
  colnames(PTCP_NI) = c("Neumonía", "Intubados")
  rownames(PTCP_NI) = c("CCM", "SCM")  
  
# Asignar valores a la matriz    
    PTCP_NI[1,1] = round(P_CCM_N, 4)
    PTCP_NI[1,2] = round(P_CCM_I, 4)
    PTCP_NI[2,1] = round(P_SCM_N, 4)
    PTCP_NI[2,2] = round(P_SCM_I, 4)

# Generar tabla | root: TCP
  PTCP_NI = as.table(PTCP_NI)
  cat("\n\nTasa de Neumonía e Intubación | Datos Muestrales\n\n")
  cat("     CCM: Con comorbilidad, SCM: Sin comorbilidad\n\n")
  PTCP_NI
  
# Matriz numerica 1x4 | Tasa de supervivencia SARS-COV-2 (General) | Datos Muestrales
  PTCP_SG = matrix(rep(0, times=4), ncol=4, byrow=TRUE)
  colnames(PTCP_SG) = c("2022", "2021", "NL", "CDMX")
  rownames(PTCP_SG) = c("Tasa de Supervivencia")  
  
# Asignar valores a la matriz    
  PTCP_SG[1,1] = round(P_S2022, 4)
  PTCP_SG[1,2] = round(P_S2021, 4)
  PTCP_SG[1,3] = round(P_SNL, 4)
  PTCP_SG[1,4] = round(P_SCDMX, 4)
  
    
# Generar tabla | root: TCP
  PTCP_SG = as.table(PTCP_SG)
  cat("\n\nTasa de supervivencia SARS-COV-2 (General) | Datos Muestrales\n\n")
  PTCP_SG

```


# Prueba de Independencia | Año vs Supervivencia
```{r}

PI = chisq.test(TCP_SG_PA)
PI
cat("Con base en la prueba del valor p (a un alpha = 0.05), se rechaza la hipótesis nula es decir, el número de pacientes con casos confirmados de SARS-COV-2 que sobreviven es dependiente de el año.")

```




# Pruebas de Hipótesis & Intevalos de Confianza | Proporción
```{r}

ph_ic_prop = function(alpha, pos_A, pos_B, n_A, n_B, Tdif_p, H_A){
  
  prop_A = pos_A / n_A
  prop_B = pos_B / n_B
  p_c = ( n_A*prop_A + n_B*prop_B ) / ( n_A + n_B)
  sigma_p = sqrt( p_c*(1-p_c) * ( (1 / n_A) + (1 / n_B) ) ) 

  # Intervalos de Confianza
    emax = qnorm(alpha/2) * sigma_p
    Edif_p = prop_A - prop_B
    liml = Edif_p - abs(emax)
    limu = Edif_p + abs(emax)
    cat("La diferencia de proporciones estimada es de", round(Edif_p, 4), "y la verdadera diferencia de proporciones de al población se encuentra dentro del intervalo [", round(liml, 4), ",", round(limu, 4), "] a un nivel de confianza del", (1-alpha)*100, "%.\n" )
    
  # Pruebas de Hipótesis
    # Supuestos
      if ( ( prop_A*n_A > 10 ) & ( ( 1 - prop_A)*n_A > 10 ) & ( prop_B*n_B > 10 ) & ( ( 1 - prop_B)*n_B > 10 ) ){
        cat("Se cumplen los supuestos del modelo de la diferencia de proporciones.\n")
      } else {
        cat("No se cumplen los supuestos del modelo de la diferencia de proporciones.\n")
      }
    z_0 = qnorm(alpha)
    z_E = ( Edif_p - Tdif_p) / sigma_p
    if ( H_A == "G" ) {
      p_V = 1 - pnorm(z_E)
    } else if ( H_A == "L") {
      p_V = pnorm(Z_E)
    } else if ( H_A == "TS") {
      p_V = pnorm(z_E)
      alpha = alpha/2
    }
    
    cat("z_0 =", z_0, "\n")
    cat("z_E =", z_E, "\n")
    cat("Valor p =", p_V, "\n")
      
    if ( (abs(z_E) >= abs(z_0))) {
      cat("Con base en el enfoque clásico, la hipótesis nula se rechaza.\n")
    } 
    if ( p_V <= alpha ) {
      cat("Con base en el enfoque del valor p, la hipótesis nula se rechaza.\n")
    } 
    if ( (abs(z_E) < abs(z_0)) & ( p_V > alpha ) ) {
      cat("No hay evidencia para rechazar la hipótesis nula.\n")
    }
  
  # Graficar
    plot(0, ylim=c(0,2), xlim=c(0-abs(liml),0+abs(limu)), yaxt="n", ylab="")
    axis(2, at=c(1), labels=c("Intervalo a 95% de confianza."))
    arrows(liml, 1, limu, 1, angle=90, code=3, length = 0.1, lwd = 2)
    abline(v = Tdif_p, col="red")
    points(Edif_p, 1, pch=19, cex=1.1)
  
  }

```

## ¿EXTRA?: Con Comorbilidad vs. Sin Comorbilidad: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 es mayor para aquellos sin diabetes?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{SCM}}-p_{_{CCM}} = 0$
-   $H_A: p_{_{SCM}}-p_{_{CCM}} > 0$
```{r}

ph_ic_prop (0.05, TCP[3,5], TCP[1,5], TCP[4,5], TCP[2,5], 0, "G")

```

## EXTRA: 2022 vs. 2021: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 es mayor este año 2022 a comparación del pasado 2021?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{2022}}-p_{_{2021}} = 0$
-   $H_A: p_{_{2022}}-p_{_{2021}} > 0$
```{r}

ph_ic_prop (0.05, TCP_SG[1,1], TCP_SG[1,2], TCP_SG[2,1], TCP_SG[2,2], 0, "G")

```

## EXTRA: NL vs. CDMX: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 es diferente en NL y CMDX?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{NL}}-p_{_{CDMX}} = 0$
-   $H_A: p_{_{NL}}-p_{_{CDMX}} \neq 0$
```{r}

ph_ic_prop (0.05, TCP_SG[1,3], TCP_SG[1,4], TCP_SG[2,3], TCP_SG[2,4], 0, "TS")

```

## EXTRA: Neumonía CCM vs. Neumonía SCM: ¿Se puede afirmar que la proporción de pacientes que desarollaron neumonía es mayor entre aquellos con diabetes que aquellos sin?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{CCMN}}-p_{_{SCMN}} = 0$
-   $H_A: p_{_{CCMN}}-p_{_{SCMN}} > 0$
```{r}

ph_ic_prop (0.05, TCP_NI[1,1], TCP_NI[2,1], TCP_NI[1,3], TCP_NI[2,3], 0, "G")

```

## Intubados CCM vs. Intubados SCM: ¿Se puede afirmar que la proporción de pacientes que fueron intubados es mayor entre aquellos con diabetes que aquellos sin?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{CCMI}}-p_{_{SCMI}} = 0$
-   $H_A: p_{_{CCMI}}-p_{_{SCMI}} > 0$
```{r}

ph_ic_prop (0.05, TCP_NI[1,2], TCP_NI[2,2], TCP_NI[1,3], TCP_NI[2,3], 0, "G")

```

## REQUISITO: 2022 CCM vs. 2022 SCM: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 es mayor este año 2022 en pacientes sin diabetes a comparación de aquellos con ?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{SCM2022}}-p_{_{CCM2022}} = 0$
-   $H_A: p_{_{SCM2022}}-p_{_{CCM2022}} > 0$
```{r}

ph_ic_prop (0.05, TCP[3,1], TCP[1,1], TCP[4,1], TCP[2,1], 0, "G")

```

## REQUISITO: 2021 CCM vs. 2021 SCM: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 es mayor este año 2022 en pacientes sin diabetes a comparación de aquellos con ?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{SCM2021}}-p_{_{CCM2021}} = 0$
-   $H_A: p_{_{SCM2021}}-p_{_{CCM2021}} > 0$
```{r}

ph_ic_prop (0.05, TCP[3,2], TCP[1,2], TCP[4,2], TCP[2,2], 0, "G")

```

## ¿REQUISITO?: 2022 CCM vs. 2021 CCM: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 es menor este año 2022 en pacientes con diabetes a comparación de del año 2021?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{CCM2021}}-p_{_{CCM2022}} = 0$
-   $H_A: p_{_{CCM2021}}-p_{_{CCM2022}} > 0$
```{r}

ph_ic_prop (0.05, TCP[1,1], TCP[1,2], TCP[2,1], TCP[2,2], 0, "G")

```

## ¿REQUISITO?: 2022 SCM vs. 2021 SCM: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 es menor este año 2022 en pacientes sin diabetes a comparación de del año 2021?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{SCM2021}}-p_{_{SCM2022}} = 0$
-   $H_A: p_{_{SCM2021}}-p_{_{SCM2022}} > 0$
```{r}

ph_ic_prop (0.05, TCP[3,1], TCP[3,2], TCP[4,1], TCP[4,2], 0, "G")

```

## REQUISITO: NL CCM vs. CDMX CCM: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 con diabetes es diferente en NL y CMDX?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{NL CCM}}-p_{_{CDMX CCM}} = 0$
-   $H_A: p_{_{NL CCM}}-p_{_{CDMX CCM}} \neq 0$
```{r}

ph_ic_prop (0.05, TCP[1,3], TCP[1,4], TCP[2,3], TCP[2,4], 0, "TS")

```

## REQUISITO: NL SCM vs. CDMX SCM: ¿Se puede afirmar que la tasa de supervivencia ante el SARS-COV-2 sin diabetes es diferente en NL y CMDX?

-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: p_{_{NL SCM}}-p_{_{CDMX SCM}} = 0$
-   $H_A: p_{_{NL SCM}}-p_{_{CDMX SCM}} \neq 0$
```{r}

ph_ic_prop (0.05, TCP[3,3], TCP[3,4], TCP[4,3], TCP[4,4], 0, "TS")

```



# Manejo de Datos | Díaz desde presencia de síntomas hasta defunción. | Datos Muestrales
```{r}

# Subset: difuntos con comorbilidad (diabetes) presente | root: CCM
  CCM_D = subset(CCM, CCM$FECHA_DEF!="9999-12-31")
# Subset: difuntos sin comorbilidad (diabetes) | root: SCM
  SCM_D = subset(SCM, SCM$FECHA_DEF!="9999-12-31")

# Vector: Díaz desde presencia de síntomas hasta defunción con comorbilidad | root: CCM_D
  DSINT_DCCM = as.Date(CCM_D$FECHA_DEF) - as.Date(CCM_D$FECHA_SINTOMAS)

# Vector: Díaz desde presencia de síntomas hasta defunción con comorbilidad | root: SCM_D
  DSINT_DSCM = as.Date(SCM_D$FECHA_DEF) - as.Date(SCM_D$FECHA_SINTOMAS)

# Medidas descriptivas con diabetes
  cat("CON DIABETES:\n")
  NDSINT_DCCM = as.numeric(DSINT_DCCM)

  # Medidas de Centro
    mean_DCCM = mean(NDSINT_DCCM)
    median_DCCM = median(NDSINT_DCCM)
    t_Centro_DCCM = c(mean_DCCM, median_DCCM)
    names(t_Centro_DCCM) = c("Media", "Mediana")
    t_Centro_DCCM
  
  # Medidas de Dispersión
    sd_DCCM = sd(NDSINT_DCCM) # Desviación Estandar
    var_DCCM = var(NDSINT_DCCM) # Varianza
    IQR_DCCM = IQR(NDSINT_DCCM) # Rango Interquartil
    R_DCCM = max(NDSINT_DCCM)-min(NDSINT_DCCM) # Rango
    
    t_Dispersion_DCCM = c(sd_DCCM, var_DCCM, IQR_DCCM, R_DCCM)
    names(t_Dispersion_DCCM) = c("Desviación Estandar", "Varianza", "Rango Intercuartil", "Rango") 
    t_Dispersion_DCCM
  
  # Medidas de Forma
    kurt_DCCM = kurtosis(NDSINT_DCCM)
    bias_DCCM = skewness(NDSINT_DCCM)
    t_Forma_DCCM = c(kurt_DCCM, bias_DCCM)
    names(t_Forma_DCCM) = c("Curtosis", "Sesgo")
    t_Forma_DCCM

    
# Medidas descriptivas sin diabetes
  cat("SIN DIABETES:\n")
  NDSINT_DSCM = as.numeric(DSINT_DSCM)

  # Medidas de Centro
    mean_DSCM = mean(NDSINT_DSCM)
    median_DSCM = median(NDSINT_DSCM)
    t_Centro_DSCM = c(mean_DSCM, median_DSCM)
    names(t_Centro_DSCM) = c("Media", "Mediana")
    t_Centro_DSCM
  
  # Medidas de Dispersión
    sd_DSCM = sd(NDSINT_DSCM) # Desviación Estandar
    var_DSCM = var(NDSINT_DSCM) # Varianza
    IQR_DSCM = IQR(NDSINT_DSCM) # Rango Interquartil
    R_DSCM = max(NDSINT_DSCM)-min(NDSINT_DSCM) # Rango
    
    t_Dispersion_DSCM = c(sd_DSCM, var_DSCM, IQR_DSCM, R_DSCM)
    names(t_Dispersion_DSCM) = c("Desviación Estandar", "Varianza", "Rango Intercuartil", "Rango") 
    t_Dispersion_DSCM
  
  # Medidas de Forma
    kurt_DSCM = kurtosis(NDSINT_DSCM)
    bias_DSCM = skewness(NDSINT_DSCM)
    t_Forma_DSCM = c(kurt_DSCM, bias_DSCM)
    names(t_Forma_DSCM) = c("Curtosis", "Sesgo")
    t_Forma_DSCM
  
```


# Gráficos | Díaz desde presencia de síntomas hasta defunción. | Datos Muestrales
```{r}

# Gráficos de días de hospitalización con diabetes

  # Gráfico de caja y bigotes
    boxplot(DSINT_DCCM, col = "red", main = "Días desde la presencia de síntomas hasta su defunción", horizontal=TRUE)
    
  # Gráfico histograma
      hist(as.numeric(DSINT_DCCM), breaks=50 , col = "red", main = "Días desde la presencia de síntomas hasta su defunción" )
    

# Gráficos de días de hospitalización sin diabetes
  
  # Gráfico de caja y bigotes
    boxplot(DSINT_DSCM , col = "green", main = "Días desde la presencia de síntomas hasta su defunción", horizontal=TRUE)
    
  # Gráfico histograma
    hist(as.numeric(DSINT_DSCM), breaks=50 , col = "green", main = "Días desde la presencia de síntomas hasta su defunción")

```


# Pruebas de Hipótesis & Intevalos de Confianza | Media
```{r}

ph_ic_mu = function(alpha, mu_A, mu_B, n_A, n_B, T_dif_mu, H_A, var_A, var_B){
  
  sigma_mu = sqrt( ( var_A / n_A ) + ( var_B / n_B ) ) 

  # Intervalos de Confianza
  Emax = qnorm(alpha/2) * sigma_mu
  ep_dif_mu = mu_A - mu_B
  liml = ep_dif_mu - abs(Emax)
  limu = ep_dif_mu + abs(Emax)
  cat("La diferencia de medias estimada es de", round(ep_dif_mu, 4), "y la verdadera diferencia de medias de al población se encuentra dentro del intervalo [", round(liml, 4), ",", round(limu, 4), "] a un nivel de confianza del", (1-alpha)*100, "%.\n" )
  
  # Pruebas de Hipótesis
  z_0 = qnorm(alpha)
  z_E = ( ep_dif_mu - T_dif_mu) / sigma_mu
  if ( H_A == "G" ) {
    p_V = 1 - pnorm(z_E)
  } else if ( H_A == "L") {
    p_V = pnorm(Z_E)
  } else if ( H_A == "TS") {
    p_V = pnorm(z_E)
    alpha = alpha/2
  }
  
  cat("z_0 =", z_0, "\n")
  cat("z_E =", z_E, "\n")
  cat("Valor p =", p_V, "\n")
    
  if ( (abs(z_E) >= abs(z_0))) {
    cat("Con base en el enfoque clásico, la hipótesis nula se rechaza.\n")
  } 
  if ( p_V <= alpha ) {
    cat("Con base en el enfoque del valor p, la hipótesis nula se rechaza.\n")
  } 
  if ( (abs(z_E) < abs(z_0)) & ( p_V > alpha ) ) {
    cat("No hay evidencia para rechazar la hipótesis nula.\n")
  }
  
  # Graficar
    plot(0, ylim=c(0,2), xlim=c(0-abs(liml),0+abs(limu)), yaxt="n", ylab="")
    axis(2, at=c(1), labels=c("Intervalo a 95% de confianza."))
    arrows(liml, 1, limu, 1, angle=90, code=3, length = 0.1, lwd = 2)
    abline(v = T_dif_mu, col="red")
    points(ep_dif_mu, 1, pch=19, cex=1.1)

}

```


## ¿REQUISITO?: Diferencia de medias de días desde la presencia de síntomas hasta defunción, CCM VS SCM: ¿Se puede afirmar que aquellos pacientes con diabetes sobreviven en promedio menos que aquellos sín?

-   Debido a el sesgo de la distribución, la mediana se utilizará como estimador puntual de la media poblacional.
-   Nivel de confianza: 95%
-   Nivel de significacnia: $\alpha = 0.05$
-   $H_0: \mu_{_{SCM}}-\mu_{_{CCM}} = 0$
-   $H_A: \mu_{_{SCM}}-\mu_{_{CCM}} > 0$ 
```{r}

ph_ic_mu(0.05, median_DSCM, median_DCCM, nrow(SCM_D), nrow(CCM_D), 0, "G", var_DSCM, var_DCCM)

```











